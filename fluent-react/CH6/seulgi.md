# CH6 서버 사이드 리액트

- 리액트
    - 클라이언트 사이드 라이브러리로 시작
    - 효율적이고 확장 가능한 UI의 필요성을 해결하기 위해 메타에서 개발

# 6.1 클라이언트 사이드 렌더링 한계

## 6.1.1 검색 엔진 최적화

- 일부 검색 엔진의 크롤러가 자바스크립트를 실행하지 않음
- 검색 엔진 크롤러의 구현 방식이 매우 다양하고, 폐쇄적이며 공개되지 않아 명확하지 않음
- 최신 검색 엔진에서 잘 작동하지만, 서버 기반 애플리케이션 없다면 문제가 발생할 위험 있음
    - 어떤 문제? 빈 HTML 파일 전송
    - 네트워크 폭포
        - 처음 요청할 때 사용자에게 필요한 파일 전부를 다운로드하지 않고 페이지를 읽어 들인 후 다시 요청해서 전체 사이트를 위한 자바스크립트를 읽어 들여야 함

## 6.1.2 성능

- 느린 네트워크나 낮은 성능 기기에서 성능 문제
- 콘텐츠를 렌더링하기 전 자바스크립트를 다운로드하고 파싱과 실행까지 해야하기에 초기 콘텐츠 렌더링이 지연 될 수 있음
    - 오래걸리면 사용자가 페이지를 떠날 수 있고, 검색엔진 페이지 순위에 부정적 영향을 미칠 수 있음
- 핵심 콘텐츠를 서버 사이드에서 렌더링 → 모든 사용자와 검색 엔진이 자바스크립트 실행 여부와 관계없이 기본 콘텐츠와 기능에 접근할 수 있음

## 6.1.3 보안

- CSRF(cross-site request forgery)
    - CSRF 방지 토큰을 전송 → 클라이언트가 해탕 토큰을 서버에 다시 제출
- NEXT 문제 있지않았나? 얼마전에??
    
    https://junghan92.medium.com/%eb%b2%88%ec%97%ad-next-js%ec%99%80-%ed%9b%bc%ec%86%90%eb%90%9c-%eb%af%b8%eb%93%a4%ec%9b%a8%ec%96%b4-%ec%9d%b8%ea%b0%80-%ec%95%84%ed%8b%b0%ed%8c%a9%ed%8a%b8-1f8a8fa159db
    

# 6.2 서버 렌더링의 부상

## 6.2.1 서버 렌더링의 장점

- 최초 의미 있는 페인트가 완성되는 시간이 빨라짐
- 접근성 개선
- SEO 개선
- 보안 향상

# 6.3 하이드레이션

- 서버에서 생성되어 클라이언트로 전송되는 정적 HTML에 이벤트 리스너와 여러 자바스크립트 기능을 추가하는 프로세스를 의미하는 용어
- 목적
    - 브라우저가 서버 렌더링 애플리케이션을 읽어 들인 후 상호 작용을 추가해서 사용자에게 빠르고 원활한 경험을 제공

## 6.3.1 하이드레이션에 대한 비판

- 필요 이상으로 느리다!
- 서버에서 리액트 애플리케이션을 먼저 렌더 → 렌더링된 출력을 클라이언트에 전달 → 브라우저가 클라이언트 번들 다운로드 → 이벤트 리스너 추가 → 클라이언트를 리렌더링
- 재개 가능성
    - 전체 애플리케이션이 서버에서 렌더링되어 브라우저로 스트리밍
    - 초기 마크업과 함께 모든 인터랙티브 동작이 직렬화되어 클라이언트로 전송
    - 서버가 중단한 부분 부터 다시 시작할 수 있음
    - 파지만, 구현에 따른 복잡성 증가

# 6.4 서버 렌더링 작성

- 서버 렌더링 프레임워크 Next.js 또는 Remix 사용

## 6.4.1 클라이언트 전용 리액트 앱에 서버 렌더링을 수동으로 추가하기

- 프로젝트 루트에 server.js 생성하여 서버에서 리액트 앱 렌더링
    - ReactDOMServer.renderToString()을 사용해 리액트 애플리케이션을 HTML 문자열로 렌더링

## 6.4.2 하이드레이션

# 6.5 리액트 서버 렌더링 API

## 6.5.1 renderToString

- 리액트에서 제공하는 서버 사이드 렌더링API
- react-dom/server 패키지에서 renderToString함수를 가져와 사용
- 리액트 엘리먼트의 트리 탐색하고 실제 DOM 엘리먼트에 해당하는 문자열 표현으로 변환한 다음 전체 문자열을 결과로 반환
    - 동기식 API 이므로 실행이 중단되거나 일시적으로 중지될 수 없음
- 단점
    - 성능
        - 처리 속도 느릴 수 있음
    - 스트리밍 자원 부족
        - 첫번째 바이트 시간 Time To First Byte (TTFB) 느려지고 HTML 수신을 시작하기까지 더 오랜시간이 걸릴 수 있음

## 6.5.2 renderToPipeableStream

- 리액트 18에 도입된 서버사이드 렌더링 API
- 응답 객체로 파이프할 수 있는 스트림 반환
- 서스펜스를 완벽하게 지원함
- TTFB 지표를 개선하기 위해 리액트 컴포넌트를 쓰기 가능 스트림으로 스트리밍
- 선언적으로 기술된 리액트 엘리먼트의 트리를 인수로 받고, 반환 결과는 HTML문자열이 아니라 Node.js 스트림이 됨
    - 청크 단위로 점진적 처리함
    - Node.js 스트림 ?
        - 출발지에서 목적지로 흐르는 데이터의 흐름
        - 스트림 간에 데이터를 파이프 하는 기능
        - 백프레셔 처리 지원
            - 데이터 전송 중 발생하는 문제, 버퍼 뒤에 데이터가 쌓이는 것

## 6.5.3 renderToReadableStream

- Node.js 스트림, 브라우저 스트림 두개 모두 지원하기위해 나온 API

## 6.5.4 언제 무엇을 사용 해야 하나요?

- 상황에 따라 다르다.
- 그냥 프레임워크를 사용하라.

# 6.6 직접 구현하지 마세요

- 에지케이스 및 복잡성 처리
- 성능 최적화
- 개발자 경험 및 생산성
- 모범 사례 코딩규칙…

# 6.7 돌아보기

- 서버 사이드 렌더링과 하이드레이션
    - 웹 에플리케이션의 성능, 사용자 경험, SEO 개선을 보장하는 강력한 기술
- 리액트에서 제공하는 서버사이드렌더링API

# 6.8 복습하기

1. 리액트 애플리케이션에서 서버 사이드 렌더링을 사용할 때 유리한 주요 장점은 무엇인가요?
    - 초기 로딩 성능 개선, SEO 향상, 접근성 개선, 보안 향상
2. 리액트에서 하이드레이션은 어떻게 작동하며 왜 중요한가요?
    - 서버에서 생성된 정적 HTML에 리액트의 이벤트 리스너와 상태를 연결하는 과정
    - 서버가 먼저 HTML을 생성해 클라이언트에 보내면 브라우저는 즉시 표현하고 리액트 자바스크립트가 로드되면 기존 DOM노드에 이밴트 핸들러를 연결하고 메모리에 컴포넌트 트리를 재구성
3. 재개 가능성이란 무엇인가요? 하이드레이션보다 좋다고 주장하는 근거는 무엇인가요?
    - 하이드레이션이 전체 애플리케이션 상태를 재구성 vs 재개 가능성은 필요한 부분만 선택적으로 활성화
4. 클라이언트 사이드 렌더링의 주요 장점과 약점은 무엇인가요?
    - 장점 : 개발 경험이 단순, 서버 부하 감소, SPA 페이지 전환 매끄럽
    - 단점 : 초기 로딩 시간 길어 사용자 경험 저하, SEO 불리, …
5. 리액트에서 renderToPipeableStream 와 renderToReadableStream API 의 주요 차이점은 무엇인가요?
    - 환경과 기능에 차이가 있음
    - Node.js 환경에 최적화 vs 웹 표준 기반으로 브라우저 환경에서 사용

# 6.9 미리보기

- 리액트 동시성